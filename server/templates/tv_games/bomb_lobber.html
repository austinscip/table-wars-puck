<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>üí£ BOMB LOBBER - Table Wars</title>
    <script src="https://cdn.socket.io/4.5.4/socket.io.min.js"></script>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body {
            background: #000;
            font-family: 'Arial Black', sans-serif;
            overflow: hidden;
        }
        canvas { display: block; background: #1a1a1a; }
        #hud {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            text-align: center;
        }
        #timer {
            font-size: 180px;
            font-weight: bold;
            color: #FFD700;
            text-shadow: 0 0 50px #FFD700;
            animation: pulse 1s infinite;
        }
        #timer.danger { color: #FF0000; animation: explode 0.2s infinite; }
        @keyframes pulse {
            0%, 100% { transform: scale(1); }
            50% { transform: scale(1.05); }
        }
        @keyframes explode {
            0%, 100% { transform: scale(1) rotate(-2deg); }
            50% { transform: scale(1.2) rotate(2deg); }
        }
        .player-stats {
            position: absolute;
            top: 20px;
            right: 20px;
            background: rgba(0,0,0,0.8);
            padding: 20px;
            border-radius: 15px;
            color: white;
            min-width: 200px;
        }
        .player-item {
            display: flex;
            justify-content: space-between;
            padding: 10px;
            margin: 5px 0;
            border-radius: 8px;
            align-items: center;
        }
        .player-item.has-bomb {
            background: rgba(255,0,0,0.3);
            border: 2px solid #FF0000;
            animation: glow 0.5s infinite;
        }
        @keyframes glow {
            0%, 100% { box-shadow: 0 0 20px #FF0000; }
            50% { box-shadow: 0 0 40px #FF0000; }
        }
        .lives {
            color: #FF0000;
            font-size: 24px;
        }
    </style>
</head>
<body>
    <canvas id="canvas"></canvas>
    <div id="hud">
        <div id="timer">15</div>
    </div>
    <div class="player-stats" id="playerStats"></div>

    <script>
        const canvas = document.getElementById('canvas');
        const ctx = canvas.getContext('2d');
        canvas.width = window.innerWidth;
        canvas.height = window.innerHeight;

        const socket = io();
        let gameState = null;

        socket.on('connect', () => {
            const urlParams = new URLSearchParams(window.location.search);
            const sessionId = urlParams.get('session');
            if (sessionId) {
                socket.emit('join_multiplayer_session', { session_id: parseInt(sessionId) });
            }
        });

        socket.on('multiplayer_state_update', (state) => {
            gameState = state;
            updateHUD(state);
        });

        function updateHUD(state) {
            const timerEl = document.getElementById('timer');
            timerEl.textContent = Math.ceil(state.bomb_timer);
            timerEl.className = state.bomb_timer < 5 ? 'danger' : '';

            const statsEl = document.getElementById('playerStats');
            statsEl.innerHTML = '<h3>PLAYERS</h3>';
            state.players.forEach(player => {
                const div = document.createElement('div');
                div.className = player.has_bomb ? 'player-item has-bomb' : 'player-item';
                div.innerHTML = `
                    <span>${player.name}</span>
                    <span class="lives">${'‚ù§Ô∏è'.repeat(player.lives)}</span>
                `;
                statsEl.appendChild(div);
            });
        }

        function draw() {
            ctx.fillStyle = '#1a1a1a';
            ctx.fillRect(0, 0, canvas.width, canvas.height);

            if (!gameState) {
                requestAnimationFrame(draw);
                return;
            }

            const centerX = canvas.width / 2;
            const centerY = canvas.height / 2;
            const radius = Math.min(canvas.width, canvas.height) * 0.35;

            // Draw arena circle
            ctx.strokeStyle = '#444';
            ctx.lineWidth = 3;
            ctx.beginPath();
            ctx.arc(centerX, centerY, radius, 0, Math.PI * 2);
            ctx.stroke();

            // Draw players
            gameState.players.forEach(player => {
                const x = centerX + (player.x - 50) / 50 * radius * 0.8;
                const y = centerY + (player.y - 50) / 50 * radius * 0.8;

                // Player circle
                ctx.fillStyle = player.color;
                ctx.beginPath();
                ctx.arc(x, y, 30, 0, Math.PI * 2);
                ctx.fill();

                // Bomb on player
                if (player.has_bomb) {
                    ctx.fillStyle = '#000';
                    ctx.font = 'bold 48px Arial';
                    ctx.textAlign = 'center';
                    ctx.textBaseline = 'middle';
                    ctx.fillText('üí£', x, y - 50);

                    // Danger circle
                    const pulse = Math.sin(Date.now() / 100) * 20 + 60;
                    ctx.strokeStyle = 'rgba(255, 0, 0, 0.6)';
                    ctx.lineWidth = 3;
                    ctx.beginPath();
                    ctx.arc(x, y, pulse, 0, Math.PI * 2);
                    ctx.stroke();
                }

                // Name
                ctx.fillStyle = 'white';
                ctx.font = 'bold 18px Arial';
                ctx.fillText(player.name, x, y + 50);
            });

            requestAnimationFrame(draw);
        }

        draw();
    </script>
</body>
</html>
