; PlatformIO Project Configuration File - UPGRADED
;
; Includes all libraries needed for the new features:
; - OTA Updates
; - Dual-Core
; - Capacitive Touch
; - ESP-NOW
; - I2S Audio (optional)
; - Bluetooth A2DP (optional)

[env:esp32]
platform = espressif32
board = esp32dev
framework = arduino

; Upload settings
upload_speed = 921600
monitor_speed = 115200

; Build flags
build_flags =
    -D PUCK_ID=1
    -D FIRMWARE_VERSION=\"1.0.0\"
    -D SERVER_URL=\"http://192.168.1.100:5001\"

; Required libraries
lib_deps =
    ; Core dependencies
    fastled/FastLED@^3.6.0
    adafruit/Adafruit MPU6050@^2.2.4
    bblanchon/ArduinoJson@^6.21.0

    ; ESP-NOW (built-in, no library needed)

    ; OTA Updates (built-in, no library needed)

    ; Optional: I2S Audio (uncomment if using I2S speaker)
    ; pschatzmann/ESP32-audioI2S@^0.9.0

    ; Optional: Bluetooth A2DP (uncomment if using Bluetooth audio)
    ; pschatzmann/ESP32-A2DP@^1.8.0

    ; Optional: SD Card (built-in, no library needed)

    ; Optional: Camera (uncomment if using ESP32-CAM)
    ; espressif/esp32-camera@^2.0.0

[env:esp32_ota]
; Environment for OTA (wireless) uploads
platform = espressif32
board = esp32dev
framework = arduino
upload_protocol = espota
upload_port = TableWarsPuck.local  ; or use IP address like 192.168.1.100
upload_flags =
    --port=3232
    --auth=puck2024

monitor_speed = 115200

build_flags =
    -D PUCK_ID=1
    -D FIRMWARE_VERSION=\"1.0.0\"
    -D SERVER_URL=\"http://192.168.1.100:5001\"

lib_deps =
    fastled/FastLED@^3.6.0
    adafruit/Adafruit MPU6050@^2.2.4
    bblanchon/ArduinoJson@^6.21.0

; ============================================================================
; MULTI-PUCK ENVIRONMENTS (for deploying to multiple pucks)
; ============================================================================

[env:puck1]
extends = env:esp32
build_flags =
    ${env:esp32.build_flags}
    -D PUCK_ID=1

[env:puck2]
extends = env:esp32
build_flags =
    ${env:esp32.build_flags}
    -D PUCK_ID=2

[env:puck3]
extends = env:esp32
build_flags =
    ${env:esp32.build_flags}
    -D PUCK_ID=3

[env:puck4]
extends = env:esp32
build_flags =
    ${env:esp32.build_flags}
    -D PUCK_ID=4

[env:puck5]
extends = env:esp32
build_flags =
    ${env:esp32.build_flags}
    -D PUCK_ID=5

[env:puck6]
extends = env:esp32
build_flags =
    ${env:esp32.build_flags}
    -D PUCK_ID=6

; ============================================================================
; OTA DEPLOYMENT TO ALL PUCKS
; ============================================================================

[env:puck1_ota]
extends = env:esp32_ota
upload_port = 192.168.1.101  ; Puck 1 IP
build_flags =
    ${env:esp32.build_flags}
    -D PUCK_ID=1

[env:puck2_ota]
extends = env:esp32_ota
upload_port = 192.168.1.102  ; Puck 2 IP
build_flags =
    ${env:esp32.build_flags}
    -D PUCK_ID=2

[env:puck3_ota]
extends = env:esp32_ota
upload_port = 192.168.1.103  ; Puck 3 IP
build_flags =
    ${env:esp32.build_flags}
    -D PUCK_ID=3

[env:puck4_ota]
extends = env:esp32_ota
upload_port = 192.168.1.104  ; Puck 4 IP
build_flags =
    ${env:esp32.build_flags}
    -D PUCK_ID=4

[env:puck5_ota]
extends = env:esp32_ota
upload_port = 192.168.1.105  ; Puck 5 IP
build_flags =
    ${env:esp32.build_flags}
    -D PUCK_ID=5

[env:puck6_ota]
extends = env:esp32_ota
upload_port = 192.168.1.106  ; Puck 6 IP
build_flags =
    ${env:esp32.build_flags}
    -D PUCK_ID=6

; ============================================================================
; USAGE EXAMPLES
; ============================================================================

; Upload via USB to Puck 1:
; pio run -e puck1 -t upload

; Upload via OTA (WiFi) to Puck 1:
; pio run -e puck1_ota -t upload

; Upload to ALL pucks via OTA:
; pio run -e puck1_ota -t upload && pio run -e puck2_ota -t upload && pio run -e puck3_ota -t upload && pio run -e puck4_ota -t upload && pio run -e puck5_ota -t upload && pio run -e puck6_ota -t upload

; Monitor serial output:
; pio device monitor
